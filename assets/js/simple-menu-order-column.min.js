/*!
 * Simple Menu Order Column
 *
 * https://github.com/ChillCode/simple-menu-order-column/
 *
 * Copyright (C) 2024 ChillCode
 *
 * @license Released under the General Public License v3.0 https://www.gnu.org/licenses/gpl-3.0.html
 */
!function(e){const{__:s,_x:n,_n:i,_nx:o}=wp.i18n;e.fn.smocDoReorder=function(n){const i=this;if(!i||e(n).prop("disabled"))return!1;function o(s,i,o){n.value=n.defaultValue,s&&s.css("display","inline-block"),e(n).prop("disabled",o).prop("title",i),window.console.warn("[Simple Menu Order Column] "+i)}let a=e(i).data("post-id");if(!a||isNaN(a))return o(null,s("The post_id is invalid.","simple-menu-order-column"),!0),!1;a=parseInt(a);const l="smoc-"+a.toString(),r=e(i).closest(".smoc-container");let t=e("#"+l+"-loader");t.length||(t=e("<span>").attr({id:l+"-loader",class:"smoc-loader dashicons dashicons-update",role:"img","aria-label":s("Updating menu order...","simple-menu-order-column")}).css({color:"#2ea2cc",animation:"iconrotation 2s infinite linear",display:"inline-block"}));let d=e("#"+l+"-loader-container");d.length?d.css({display:"none"}):(d=e("<div>").attr({id:l+"-loader-container"}).css({"padding-top":"5px",display:"none"}),d.append(t),r.append(d));let c=e("#"+l+"-success");c.length?c.css({display:"none"}):(c=e("<span>").attr({id:l+"-success",class:"smoc-success dashicons dashicons-yes-alt",role:"img","aria-label":s("The menu order has been updated successfully.","simple-menu-order-column")}).css({"padding-top":"5px",color:"#7ad03a",display:"none"}),r.append(c));let p=e("#"+l+"-error");if(p.length?p.css({display:"none"}):(p=e("<span>").attr({id:l+"-error",class:"smoc-error dashicons dashicons-dismiss",role:"img","aria-label":s("An error ocurred while updating menu order.","simple-menu-order-column")}).css({"padding-top":"5px",color:"#a00",display:"none"}),r.append(p)),!typenow||!ajaxurl)return o(p,s("Invalid WP installation, variables typenow or ajaxurl are not initialized.","simple-menu-order-column"),!0),!1;let u=e(i).val();if(u=e(i).val(),!u||isNaN(u))return o(p,s("The menu order value is invalid.","simple-menu-order-column"),!1),!1;u=parseInt(u);let m=e(i).data("wpnonce");if(!m)return o(p,s("The postNonce is invalid.","simple-menu-order-column"),!0),!1;e(n).prop("disabled",!0),d.css({display:"inline-block"});const h=new URLSearchParams;h.set("action","smoc_reorder"),h.set("_wpnonce",m);const y=jQuery.ajax({url:ajaxurl+"?"+h,type:"POST",data:{post_type:typenow,post_id:a,post_menu_order:u}});y.done((function(s){if(s.success){c.css("display","inline-block"),e(n).prop("title",u),n.currentValue=u,n.defaultValue=u;const s=e(":input[id^=smoc]").index(n);e(":input[id^=smoc]").eq(s+1).trigger("select")}else n.value=n.defaultValue,p.css("display","inline-block")})),y.fail((function(){n.value=n.defaultValue,d.css("display","none"),c.css("display","none"),p.css("display","inline-block")})),y.always((function(){d.css({display:"none"}),e(n).prop("disabled",!1)}))},e("input[id^=smoc]").on("focus",(function(){this.currentValue=this.value,e(this).prop("title",parseInt(this.value));const s="smoc-"+e(this).data("post-id").toString();e("#"+s+"-loader-container").css({display:"none"}),e("#"+s+"-success").css({display:"none"}),e("#"+s+"-error").css({display:"none"})})),e("input[id^=smoc]").on("focusout",(function(n){if(e(this).prop("disabled"))return!1;this.currentValue!==this.value&&(window.confirm(s("Should the menu order value be updated?","simple-menu-order-column"))?e(this).smocDoReorder(this):this.value=this.defaultValue)})),e("input[id^=smoc]").on("keypress",(function(s){"Enter"===s.key&&(s.preventDefault(),e(this).smocDoReorder(this))}))}(jQuery);